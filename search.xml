<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>创建游戏界面</title>
      <link href="/2022/05/08/3.%E5%88%9B%E5%BB%BA%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/"/>
      <url>/2022/05/08/3.%E5%88%9B%E5%BB%BA%E6%B8%B8%E6%88%8F%E7%95%8C%E9%9D%A2/</url>
      
        <content type="html"><![CDATA[<h3 id="简易游戏引擎实现"><a href="#简易游戏引擎实现" class="headerlink" title="简易游戏引擎实现"></a>简易游戏引擎实现</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable constant_">AC_GAME_OBJECTS</span> = []; <span class="comment">// 储存所有可以“动”的元素的全局数组</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable constant_">AC_GAME_OBJECTS</span>.<span class="title function_">push</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">has_called_start</span> = <span class="literal">false</span>;<span class="comment">// 是否执行过start函数</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">timedelta</span> = <span class="number">0</span>; <span class="comment">// 当前帧距离上一帧的时间间隔</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;<span class="comment">// 只会在第一帧执行一次</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;<span class="comment">// 每一帧都执行</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">on_destroy</span>(<span class="params"></span>) &#123;<span class="comment">// 在销毁之前执行一次</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">destroy</span>(<span class="params"></span>) &#123;<span class="comment">// 删掉该物体</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">on_destroy</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable constant_">AC_GAME_OBJECTS</span>.<span class="property">length</span>; i ++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable constant_">AC_GAME_OBJECTS</span>[i] === <span class="variable language_">this</span>) &#123;</span><br><span class="line">                <span class="variable constant_">AC_GAME_OBJECTS</span>.<span class="title function_">splice</span>(i, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> last_timestamp;</span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">AC_GAME_ANIMATION</span> = <span class="keyword">function</span> (<span class="params">timestamp</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable constant_">AC_GAME_OBJECTS</span>.<span class="property">length</span>; i ++) &#123;</span><br><span class="line">        <span class="keyword">let</span> obj = <span class="variable constant_">AC_GAME_OBJECTS</span>[i];<span class="comment">// 当前物体</span></span><br><span class="line">        <span class="keyword">if</span> (!obj.<span class="property">has_called_start</span>) &#123; <span class="comment">// 如果没有执行过第一帧</span></span><br><span class="line">            obj.<span class="title function_">start</span>();</span><br><span class="line">            obj.<span class="property">has_called_start</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            obj.<span class="property">timedelta</span> = timestamp - last_timestamp; <span class="comment">// 记录两帧之间时间间隔</span></span><br><span class="line">            obj.<span class="title function_">update</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    last_timestamp = timestamp; <span class="comment">// 更新下上一帧时间戳</span></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(<span class="variable constant_">AC_GAME_ANIMATION</span>); <span class="comment">//如果想在浏览器下次重绘之前继续更新下一帧动画，那么回调函数自身必须再次调用</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">requestAnimationFrame</span>(<span class="variable constant_">AC_GAME_ANIMATION</span>);<span class="comment">// 该函数会在下次浏览器刷新页面之前执行一次，通常会用递归写法使其每秒执行60次func函数。调用时会传入一个参数，表示函数执行的时间戳，单位为毫秒。</span></span><br></pre></td></tr></table></figure><h3 id="创建游戏地图"><a href="#创建游戏地图" class="headerlink" title="创建游戏地图"></a>创建游戏地图</h3><p>主要使用canvas画布进行渲染</p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GameMap</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">playground</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playground</span> = playground;<span class="comment">// 这个map是playground的</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$canvas</span> = $(<span class="string">`&lt;canvas&gt;&lt;/canvas&gt;`</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = <span class="variable language_">this</span>.<span class="property">$canvas</span>[<span class="number">0</span>].<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">width</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">height</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">$playground</span>.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">$canvas</span>); <span class="comment">//将canvas加入到playground中</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123; <span class="comment">//渲染</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = <span class="string">&quot;rgba(0, 0, 0, 0.2)&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">width</span>, <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">canvas</span>.<span class="property">height</span>);<span class="comment">// 画一个矩形</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="玩家类实现"><a href="#玩家类实现" class="headerlink" title="玩家类实现"></a>玩家类实现</h3><h4 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">constructor</span>(<span class="params">playground, x, y, radius, color, speed, is_me</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x; <span class="comment">//横坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y; <span class="comment">// 纵坐标</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="number">0</span>; <span class="comment">// 水平速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="number">0</span>; <span class="comment">// 垂直速度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">damage_x</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">damage_y</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">damage_speed</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">move_length</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playground</span> = playground;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">game_map</span>.<span class="property">ctx</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">radius</span> = radius;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">is_me</span> = is_me;<span class="comment">// 是否是自己</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eps</span> = <span class="number">0.1</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">friction</span> = <span class="number">0.9</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">spent_time</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cur_skill</span> = <span class="literal">null</span>; <span class="comment">// 判断当前选择的技能</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="创建监听事件"><a href="#创建监听事件" class="headerlink" title="创建监听事件"></a>创建监听事件</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">add_listening_events</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> outer = <span class="variable language_">this</span>;</span><br><span class="line">        <span class="comment">// 关闭画布上的鼠标监听右键</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">on</span>(<span class="string">&quot;contextmenu&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">game_map</span>.<span class="property">$canvas</span>.<span class="title function_">mousedown</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">which</span> === <span class="number">3</span>) &#123; <span class="comment">// 鼠标右键</span></span><br><span class="line">                outer.<span class="title function_">move_to</span>(e.<span class="property">clientX</span>, e.<span class="property">clientY</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">which</span> === <span class="number">1</span>) &#123; <span class="comment">// 鼠标左键</span></span><br><span class="line">                <span class="keyword">if</span> (outer.<span class="property">cur_skill</span> === <span class="string">&quot;fireball&quot;</span>) &#123; <span class="comment">// 火球技能</span></span><br><span class="line">                    outer.<span class="title function_">shoot_fireball</span>(e.<span class="property">clientX</span>, e.<span class="property">clientY</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                outer.<span class="property">cur_skill</span> = <span class="literal">null</span>;<span class="comment">// 释放完技能后清空</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        $(<span class="variable language_">window</span>).<span class="title function_">keydown</span>(<span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.<span class="property">which</span> === <span class="number">81</span>) &#123; <span class="comment">// 键盘Q键</span></span><br><span class="line">                outer.<span class="property">cur_skill</span> = <span class="string">&quot;fireball&quot;</span>;<span class="comment">// 当前技能是火球</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="实现玩家的移动"><a href="#实现玩家的移动" class="headerlink" title="实现玩家的移动"></a>实现玩家的移动</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">move_length</span> &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123; <span class="comment">// 如果移动距离小于这个数，就不再移动了</span></span><br><span class="line">               <span class="variable language_">this</span>.<span class="property">move_length</span> = <span class="number">0</span>;</span><br><span class="line">               <span class="variable language_">this</span>.<span class="property">vx</span> = <span class="variable language_">this</span>.<span class="property">vy</span> = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> moved = <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">this</span>.<span class="property">move_length</span>, <span class="variable language_">this</span>.<span class="property">speed</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">vx</span> * moved;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> += <span class="variable language_">this</span>.<span class="property">vy</span> * moved;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">move_length</span> -= moved;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="实现发射火球"><a href="#实现发射火球" class="headerlink" title="实现发射火球"></a>实现发射火球</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">shoot_fireball</span>(<span class="params">tx, ty</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> x = <span class="variable language_">this</span>.<span class="property">x</span>;</span><br><span class="line">        <span class="keyword">let</span> y = <span class="variable language_">this</span>.<span class="property">y</span>;</span><br><span class="line">        <span class="keyword">let</span> radius = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">height</span> * <span class="number">0.01</span>;<span class="comment">// 火球半径</span></span><br><span class="line">        <span class="keyword">let</span> angle = <span class="title class_">Math</span>.<span class="title function_">atan2</span>(ty - <span class="variable language_">this</span>.<span class="property">y</span>, tx - <span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">        <span class="keyword">let</span> vx = <span class="title class_">Math</span>.<span class="title function_">cos</span>(angle);</span><br><span class="line">        <span class="keyword">let</span> vy = <span class="title class_">Math</span>.<span class="title function_">sin</span>(angle);</span><br><span class="line">        <span class="keyword">let</span> color = <span class="string">&quot;orange&quot;</span>;</span><br><span class="line">        <span class="keyword">let</span> speed = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">height</span> * <span class="number">0.5</span>;</span><br><span class="line">        <span class="keyword">let</span> move_length = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">height</span> * <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">FireBall</span>(<span class="variable language_">this</span>.<span class="property">playground</span>, <span class="variable language_">this</span>, x, y, radius, vx, vy, color, speed, move_length, <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">height</span> * <span class="number">0.01</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="实现被攻击效果"><a href="#实现被攻击效果" class="headerlink" title="实现被攻击效果"></a>实现被攻击效果</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title function_">is_attacked</span>(<span class="params">angle, damage</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span> + <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>; i ++) &#123; <span class="comment">// 被击中后出现粒子效果</span></span><br><span class="line">            <span class="keyword">let</span> x = <span class="variable language_">this</span>.<span class="property">x</span>;</span><br><span class="line">            <span class="keyword">let</span> y = <span class="variable language_">this</span>.<span class="property">y</span>;</span><br><span class="line">            <span class="keyword">let</span> radius = <span class="variable language_">this</span>.<span class="property">radius</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">0.1</span>;</span><br><span class="line">            <span class="keyword">let</span> angle = <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>();</span><br><span class="line">            <span class="keyword">let</span> vx = <span class="title class_">Math</span>.<span class="title function_">cos</span>(angle);</span><br><span class="line">            <span class="keyword">let</span> vy = <span class="title class_">Math</span>.<span class="title function_">sin</span>(angle);</span><br><span class="line">            <span class="keyword">let</span> color = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">            <span class="keyword">let</span> speed = <span class="variable language_">this</span>.<span class="property">speed</span> * <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">let</span> move_length = <span class="variable language_">this</span>.<span class="property">radius</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Particle</span>(<span class="variable language_">this</span>.<span class="property">playground</span>, x, y, radius, vx, vy, color, speed, move_length);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">radius</span> -= damage;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">radius</span> &lt; <span class="number">10</span>) &#123; <span class="comment">// 小于10像素就死了</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">damage_x</span> = <span class="title class_">Math</span>.<span class="title function_">cos</span>(angle);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">damage_y</span> = <span class="title class_">Math</span>.<span class="title function_">sin</span>(angle);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">damage_speed</span> = damage * <span class="number">50</span>;<span class="comment">// 被攻击到会被击退</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> *= <span class="number">1.5</span>; <span class="comment">// 被攻击后速度变快</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="实现人机攻击"><a href="#实现人机攻击" class="headerlink" title="实现人机攻击"></a>实现人机攻击</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="variable language_">this</span>.<span class="property">spent_time</span> += <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>;</span><br><span class="line">        <span class="comment">// 4秒过后才能发射，每5s就发射一次</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">is_me</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">spent_time</span> &gt; <span class="number">4</span> &amp;&amp; <span class="title class_">Math</span>.<span class="title function_">random</span>() &lt; <span class="number">1</span> / <span class="number">300.0</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> player = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">players</span>[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">players</span>.<span class="property">length</span>)];<span class="comment">// 随机攻击目标</span></span><br><span class="line">            <span class="keyword">let</span> tx = player.<span class="property">x</span> + player.<span class="property">speed</span> * <span class="variable language_">this</span>.<span class="property">vx</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span> * <span class="number">0.3</span>;</span><br><span class="line">            <span class="keyword">let</span> ty = player.<span class="property">y</span> + player.<span class="property">speed</span> * <span class="variable language_">this</span>.<span class="property">vy</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span> * <span class="number">0.3</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">shoot_fireball</span>(tx, ty);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h3 id="游戏地图类实现"><a href="#游戏地图类实现" class="headerlink" title="游戏地图类实现"></a>游戏地图类实现</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AcGamePlayground</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">root</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span> = root;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$playground</span> = $(<span class="string">`&lt;div class=&quot;ac-game-playground&quot;&gt;&lt;/div&gt;`</span>)</span><br><span class="line">        <span class="comment">//this.hide(); // 一开始打开的是菜单界面，所以playground界面要先关闭</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">$ac_game</span>.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">$playground</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">width</span> = <span class="variable language_">this</span>.<span class="property">$playground</span>.<span class="title function_">width</span>(); <span class="comment">//记录游戏背景宽度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">height</span> = <span class="variable language_">this</span>.<span class="property">$playground</span>.<span class="title function_">height</span>(); <span class="comment">//记录游戏背景高度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">game_map</span> = <span class="keyword">new</span> <span class="title class_">GameMap</span>(<span class="variable language_">this</span>); <span class="comment">// 创建地图</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">players</span> = []; <span class="comment">// 存放游戏玩家的数组</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">players</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Player</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">width</span> / <span class="number">2</span>, <span class="variable language_">this</span>.<span class="property">height</span> / <span class="number">2</span>, <span class="variable language_">this</span>.<span class="property">height</span> * <span class="number">0.05</span>, <span class="string">&quot;white&quot;</span>, <span class="variable language_">this</span>.<span class="property">height</span> * <span class="number">0.15</span>, <span class="literal">true</span>));<span class="comment">//创建一个游戏玩家</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++) &#123; <span class="comment">// 创建几个人机玩家</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">players</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Player</span>(<span class="variable language_">this</span>, <span class="variable language_">this</span>.<span class="property">width</span> / <span class="number">2</span>, <span class="variable language_">this</span>.<span class="property">height</span> / <span class="number">2</span>, <span class="variable language_">this</span>.<span class="property">height</span> * <span class="number">0.05</span>, <span class="variable language_">this</span>.<span class="title function_">get_random_color</span>(), <span class="variable language_">this</span>.<span class="property">height</span> * <span class="number">0.15</span>, <span class="literal">false</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">show</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$playground</span>.<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">hide</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$playground</span>.<span class="title function_">hide</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">get_random_color</span>(<span class="params"></span>) &#123; <span class="comment">// 随机颜色</span></span><br><span class="line">        <span class="keyword">let</span> colors = [<span class="string">&quot;blue&quot;</span>, <span class="string">&quot;pink&quot;</span>, <span class="string">&quot;orange&quot;</span>, <span class="string">&quot;purple&quot;</span>, <span class="string">&quot;green&quot;</span>];</span><br><span class="line">        <span class="keyword">return</span> colors[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">5</span>)]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="创建火球类"><a href="#创建火球类" class="headerlink" title="创建火球类"></a>创建火球类</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">FireBall</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">playground, player, x, y, radius, vx, vy, color, speed, move_length, damage</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playground</span> = playground;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">player</span> = player;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">game_map</span>.<span class="property">ctx</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">radius</span> = radius;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vx</span> = vx;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vy</span> = vy;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">move_length</span> = move_length;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eps</span> = <span class="number">0.1</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">damage</span> = damage; <span class="comment">//伤害值</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">move_length</span> &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> moved = <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">this</span>.<span class="property">move_length</span>, <span class="variable language_">this</span>.<span class="property">speed</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">vx</span> * moved;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> += <span class="variable language_">this</span>.<span class="property">vy</span> * moved;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">move_length</span> -= moved;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">players</span>.<span class="property">length</span>; i ++) &#123;</span><br><span class="line">            <span class="keyword">let</span> player = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">players</span>[i];</span><br><span class="line">            <span class="comment">// 如果两个角色不一样，判断碰撞，并且攻击这个玩家</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">player</span> !== player &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">is_collision</span>(player)) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">attack</span>(player);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">get_dis</span>(<span class="params">x1, y1, x2, y2</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> dx = x1 - x2;</span><br><span class="line">        <span class="keyword">let</span> dy = y1 - y2;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(dx * dx + dy * dy);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">is_collision</span>(<span class="params">player</span>) &#123; <span class="comment">// 碰撞检测</span></span><br><span class="line">        <span class="keyword">let</span> distance = <span class="variable language_">this</span>.<span class="title function_">get_dis</span>(<span class="variable language_">this</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">y</span>, player.<span class="property">x</span>, player.<span class="property">y</span>);<span class="comment">// 记录火球和玩家之间的距离</span></span><br><span class="line">        <span class="comment">// 如果距离小于玩家加上火球的半径，则已经碰撞</span></span><br><span class="line">        <span class="keyword">if</span> (distance &lt; <span class="variable language_">this</span>.<span class="property">radius</span> + player.<span class="property">radius</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">attack</span>(<span class="params">player</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> angle = <span class="title class_">Math</span>.<span class="title function_">atan2</span>(player.<span class="property">y</span> - <span class="variable language_">this</span>.<span class="property">y</span>, player.<span class="property">x</span> - <span class="variable language_">this</span>.<span class="property">x</span>);</span><br><span class="line">        player.<span class="title function_">is_attacked</span>(angle,<span class="variable language_">this</span>.<span class="property">damage</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">destroy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">beginPath</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">arc</span>(<span class="variable language_">this</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">y</span>, <span class="variable language_">this</span>.<span class="property">radius</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">fill</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="实现撞击后粒子效果"><a href="#实现撞击后粒子效果" class="headerlink" title="实现撞击后粒子效果"></a>实现撞击后粒子效果</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Particle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">AcGameObject</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">playground, x, y, radius, vx, vy, color, speed, move_length</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playground</span> = playground;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> = x;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> = y;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">radius</span> = radius;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vx</span> = vx;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">vy</span> = vy;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span> = <span class="variable language_">this</span>.<span class="property">playground</span>.<span class="property">game_map</span>.<span class="property">ctx</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> = speed;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">move_length</span> = move_length;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">friction</span> = <span class="number">0.9</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">eps</span> = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">update</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">move_length</span> &lt; <span class="variable language_">this</span>.<span class="property">eps</span> || <span class="variable language_">this</span>.<span class="property">speed</span> &lt; <span class="variable language_">this</span>.<span class="property">eps</span>) &#123; <span class="comment">// 如果小于这个值粒子就可以消失了</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">destroy</span>();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> moved = <span class="title class_">Math</span>.<span class="title function_">min</span>(<span class="variable language_">this</span>.<span class="property">move_length</span>, <span class="variable language_">this</span>.<span class="property">speed</span> * <span class="variable language_">this</span>.<span class="property">timedelta</span> / <span class="number">1000</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">x</span> += <span class="variable language_">this</span>.<span class="property">vx</span> * moved;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">y</span> += <span class="variable language_">this</span>.<span class="property">vy</span> * moved;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">speed</span> *= <span class="variable language_">this</span>.<span class="property">friction</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">move_length</span> -= moved;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">render</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">beginPath</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">arc</span>(<span class="variable language_">this</span>.<span class="property">x</span>, <span class="variable language_">this</span>.<span class="property">y</span>, <span class="variable language_">this</span>.<span class="property">radius</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="property">fillStyle</span> = <span class="variable language_">this</span>.<span class="property">color</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">ctx</span>.<span class="title function_">fill</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Django </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>创建菜单界面</title>
      <link href="/2022/05/05/2.%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E7%95%8C%E9%9D%A2/"/>
      <url>/2022/05/05/2.%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E7%95%8C%E9%9D%A2/</url>
      
        <content type="html"><![CDATA[<h3 id="页面HTML设计"><a href="#页面HTML设计" class="headerlink" title="页面HTML设计"></a>页面HTML设计</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% load static %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.acwing.com/static/jquery-ui-dist/jquery-ui.min.css&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.acwing.com/static/jquery/js/jquery-3.3.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;&#123;% static &#x27;css/game.css&#x27; %&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;% static &#x27;js/dist/game.js&#x27; %&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;ac_game123&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">        &#123;#当dom tree加载完后显示代码#&#125;</span><br><span class="line">        $(document).ready(function () &#123;</span><br><span class="line">            let ac_game = new AcGame(&quot;ac_game123&quot;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>引用css文件和JavaScript文件时可以用django的模板语言，如果用到<code>static</code>要在前面加上一个<code>&#123;% load static %&#125;</code>。HTML5申明最好去掉，后面渲染可能会出问题。</p><h3 id="编写视图函数"><a href="#编写视图函数" class="headerlink" title="编写视图函数"></a>编写视图函数</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>(<span class="params">request</span>):</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">&quot;multiends/web.html&quot;</span>)</span><br></pre></td></tr></table></figure><p>render()的语法如下:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">render(request, template_name, context=<span class="literal">None</span>, content_type=<span class="literal">None</span>, status=<span class="literal">None</span>, using=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure><p>render 的参数 request 和 template_name 是必需参数，其余的参数是可选参数。</p><ul><li>request：浏览器向服务器发送的请求对象，包含用户信息、请求内容和请求方式等。</li><li>template_name：设重模板文件名，用于生成网页内容。</li><li>context：对模板上下文（模板变量）赋值，以字典格式表示，默认情况下是一个空字典。</li><li>content_type：响应内容的数据格式，一般情况下使用默认值即可。</li><li>status：HTTP状态码，默认为200。</li><li>using：设置模板引擎，用于解析模板文件，生成网页内容。</li></ul><h3 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h3><p>首先在主路由中加入创建的应用程序的路由</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&#x27;admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">&#x27;&#x27;</span>, include(<span class="string">&#x27;game.urls.index&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>然后再配置应用程序下的路由，并将其子文件夹的路由都加进来</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">&quot;&quot;</span>, index, name=<span class="string">&quot;index&quot;</span>),</span><br><span class="line">    path(<span class="string">&quot;menu/&quot;</span>, include(<span class="string">&#x27;game.urls.menu.index&#x27;</span>)),</span><br><span class="line">    path(<span class="string">&quot;playground/&quot;</span>, include(<span class="string">&#x27;game.urls.playground.index&#x27;</span>)),</span><br><span class="line">    path(<span class="string">&quot;settings/&quot;</span>, include(<span class="string">&#x27;game.urls.settings.index&#x27;</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h3 id="JavaScript文件"><a href="#JavaScript文件" class="headerlink" title="JavaScript文件"></a>JavaScript文件</h3><h4 id="整体的js"><a href="#整体的js" class="headerlink" title="整体的js"></a>整体的js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AcGame</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">id</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">id</span> = id; <span class="comment">// 获取id</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$ac_game</span> = $(<span class="string">&#x27;#&#x27;</span> + id); <span class="comment">// 将div存入ac_game对象</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">menu</span> = <span class="keyword">new</span> <span class="title class_">AcGameMenu</span>(<span class="variable language_">this</span>);<span class="comment">// 创建菜单</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">playground</span> = <span class="keyword">new</span> <span class="title class_">AcGamePlayground</span>(<span class="variable language_">this</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="menu的js"><a href="#menu的js" class="headerlink" title="menu的js"></a>menu的js</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AcGameMenu</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">root</span>) &#123; <span class="comment">//root就是html里的那个ac_game对象</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span> = root; <span class="comment">// 将对象信息保存</span></span><br><span class="line">        <span class="comment">// 如果是个html对象的话，变量加上$</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$menu</span> = $(<span class="string">`  </span></span><br><span class="line"><span class="string">        &lt;div class=&quot;ac-game-menu&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;div class=&quot;ac-game-menu-field&quot;&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;ac-game-menu-field-item ac-game-menu-field-item-single-mode&quot;&gt;</span></span><br><span class="line"><span class="string">                    单人模式</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;br&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;ac-game-menu-field-item ac-game-menu-field-item-multi-mode&quot;&gt;</span></span><br><span class="line"><span class="string">                    多人模式</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">                &lt;br&gt;</span></span><br><span class="line"><span class="string">                &lt;div class=&quot;ac-game-menu-field-item ac-game-menu-field-item-settings&quot;&gt;</span></span><br><span class="line"><span class="string">                    设置</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/div&gt;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">        `</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">root</span>.<span class="property">$ac_game</span>.<span class="title function_">append</span>(<span class="variable language_">this</span>.<span class="property">$menu</span>);<span class="comment">// 将$menu的html添加到ac_game中</span></span><br><span class="line">        <span class="comment">// find() 方法获得当前元素集合中每个元素的后代，通过选择器、jQuery 对象或元素来筛选。</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$single_mode</span> = <span class="variable language_">this</span>.<span class="property">$menu</span>.<span class="title function_">find</span>(<span class="string">&#x27;.ac-game-menu-field-item-single-mode&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$multi_mode</span> = <span class="variable language_">this</span>.<span class="property">$menu</span>.<span class="title function_">find</span>(<span class="string">&#x27;.ac-game-menu-field-item-multi-mode&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$settings</span> = <span class="variable language_">this</span>.<span class="property">$menu</span>.<span class="title function_">find</span>(<span class="string">&#x27;.ac-game-menu-field-item-settings&#x27;</span>);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">start</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">start</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">add_listening_events</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">add_listening_events</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> outer = <span class="variable language_">this</span>; <span class="comment">// 将外部的this存下来</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$single_mode</span>.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123; <span class="comment">// 被点击就调用函数</span></span><br><span class="line">            outer.<span class="title function_">hide</span>(); <span class="comment">//关闭当前界面</span></span><br><span class="line">            outer.<span class="property">root</span>.<span class="property">playground</span>.<span class="title function_">show</span>(); <span class="comment">//显示游戏界面</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$multi_mode</span>.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;click multi mode&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$settings</span>.<span class="title function_">click</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;click settings&quot;</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">show</span>(<span class="params"></span>) &#123; <span class="comment">// 显示menu界面</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$menu</span>.<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">hide</span>(<span class="params"></span>) &#123; <span class="comment">// 关闭menu界面</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$menu</span>.<span class="title function_">hide</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CSS文件"><a href="#CSS文件" class="headerlink" title="CSS文件"></a>CSS文件</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.ac-game-menu</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;/static/images/menu/background.gif&quot;</span>);</span><br><span class="line">    <span class="comment">/*填充整个图片*/</span></span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">100%</span>;</span><br><span class="line">    user-select: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ac-game-menu-field</span> &#123;</span><br><span class="line">    <span class="comment">/*百分比设置*/</span></span><br><span class="line">    <span class="attribute">width</span>: <span class="number">20vw</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">40vh</span>;</span><br><span class="line">    <span class="attribute">left</span>: <span class="number">19vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ac-game-menu-field-item</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">7vh</span>;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">18vw</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">6vh</span>;</span><br><span class="line">    <span class="attribute">font-style</span>: italic;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">2vh</span>;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(<span class="number">39</span>, <span class="number">21</span>, <span class="number">28</span>, <span class="number">0.6</span>);</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">10px</span>;</span><br><span class="line">    <span class="comment">/*字间距*/</span></span><br><span class="line">    <span class="attribute">letter-spacing</span>: <span class="number">0.5vw</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.ac-game-menu-field-item</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="comment">/*大小乘以1.2*/</span></span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.2</span>);</span><br><span class="line">    <span class="attribute">transition</span>: <span class="number">100ms</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="菜单界面效果显示"><a href="#菜单界面效果显示" class="headerlink" title="菜单界面效果显示"></a>菜单界面效果显示</h3><p><img src="https://s3.bmp.ovh/imgs/2022/05/07/7e9e784a0adb28b8.png"></p>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Django </tag>
            
            <tag> JavaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>项目创建</title>
      <link href="/2022/05/05/1.%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/"/>
      <url>/2022/05/05/1.%E9%A1%B9%E7%9B%AE%E5%88%9B%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="项目创建"><a href="#项目创建" class="headerlink" title="项目创建"></a>项目创建</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">django-admin startproject xxxxxxxx</span><br></pre></td></tr></table></figure><h3 id="项目运行"><a href="#项目运行" class="headerlink" title="项目运行"></a>项目运行</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 manager.py runserver <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span></span><br></pre></td></tr></table></figure><h3 id="项目设置"><a href="#项目设置" class="headerlink" title="项目设置"></a>项目设置</h3><h4 id="将自己的ip地址放进setting-py中"><a href="#将自己的ip地址放进setting-py中" class="headerlink" title="将自己的ip地址放进setting.py中"></a>将自己的ip地址放进setting.py中</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ALLOWED_HOSTS = [<span class="string">&quot;124.71.60.207&quot;</span>]</span><br></pre></td></tr></table></figure><h4 id="创建一个新的应用程序"><a href="#创建一个新的应用程序" class="headerlink" title="创建一个新的应用程序"></a>创建一个新的应用程序</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 manager.py startapp xxxxxxx</span><br></pre></td></tr></table></figure><h5 id="在setting-py中注册新的应用程序"><a href="#在setting-py中注册新的应用程序" class="headerlink" title="在setting.py中注册新的应用程序"></a>在setting.py中注册新的应用程序</h5><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">INSTALLED_APPS = [<span class="string">&#x27;game.apps.GameConfig&#x27;</span>,]</span><br></pre></td></tr></table></figure><h4 id="同步数据库修改"><a href="#同步数据库修改" class="headerlink" title="同步数据库修改"></a>同步数据库修改</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 manager.py migrate</span><br></pre></td></tr></table></figure><h4 id="创建超级用户"><a href="#创建超级用户" class="headerlink" title="创建超级用户"></a>创建超级用户</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python3 manager.py createsuperuser</span><br></pre></td></tr></table></figure><h3 id="配置setting-py"><a href="#配置setting-py" class="headerlink" title="配置setting.py"></a>配置setting.py</h3><p>在<code>setting.py</code>最下面</p><h4 id="存放开发者文件"><a href="#存放开发者文件" class="headerlink" title="存放开发者文件"></a>存放开发者文件</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">&#x27;static&#x27;</span>)</span><br><span class="line">STATIC_URL = <span class="string">&#x27;/static/&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="存放用户文件"><a href="#存放用户文件" class="headerlink" title="存放用户文件"></a>存放用户文件</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, <span class="string">&#x27;media&#x27;</span>)</span><br><span class="line">MEDIA_URL = <span class="string">&#x27;/media/&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="Django项目结构"><a href="#Django项目结构" class="headerlink" title="Django项目结构"></a>Django项目结构</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">mysite/</span><br><span class="line">    manage.py</span><br><span class="line">    mysite/</span><br><span class="line">        __init__.py</span><br><span class="line">        settings.py</span><br><span class="line">        urls.py</span><br><span class="line">        asgi.py</span><br><span class="line">        wsgi.py</span><br></pre></td></tr></table></figure><ul><li><code>manage.py</code>：一个命令行实用程序，可以各种方式与此 Django 项目进行交互。</li><li><code>settings.py</code>：此 Django 项目的设置&#x2F;配置。 <a href="https://docs.djangoproject.com/en/3.2/topics/settings/">Django 设置</a>会告诉你设置是如何工作的。</li><li><code>urls.py</code>：这个 Django 项目的 URL 声明；由 Django 驱动的站点的“目录”。<a href="https://docs.djangoproject.com/en/3.2/topics/http/urls/">可以在URL dispatcher</a>中阅读有关 URL 的更多信息。</li><li><code>asgi.py</code>：为项目提供服务的兼容 ASGI 的 Web 服务器的入口点。有关更多详细信息，请参阅<a href="https://docs.djangoproject.com/en/3.2/howto/deployment/asgi/">如何使用 ASGI</a>进行部署。</li><li><code>wsgi.py</code>: 为项目提供服务的 WSGI 兼容 Web 服务器的入口点。有关更多详细信息，请参阅<a href="https://docs.djangoproject.com/en/3.2/howto/deployment/wsgi/">如何使用 WSGI</a>进行部署。</li><li><code>views.py</code>: 存放各种模块。</li><li><code>models.py</code>:存放数据库类。</li><li><code>templates</code>:管理所有的HTML文件。</li></ul><h3 id="项目整体结构"><a href="#项目整体结构" class="headerlink" title="项目整体结构"></a>项目整体结构</h3><p><strong>如果文件夹下是存放python文件，那么每个文件夹下都要创建一个</strong><code>__init__.py</code><strong>文件</strong></p><p><img src="https://s3.bmp.ovh/imgs/2022/05/07/18cf946934a0b2c3.png"></p><h3 id="项目模块"><a href="#项目模块" class="headerlink" title="项目模块"></a>项目模块</h3><ol><li>单人模式</li><li>多人模式</li><li>设置</li></ol><h3 id="项目界面"><a href="#项目界面" class="headerlink" title="项目界面"></a>项目界面</h3><ol><li>菜单界面</li><li>对战界面</li><li>设置界面</li></ol>]]></content>
      
      
      <categories>
          
          <category> 后端 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
            <tag> Django </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
